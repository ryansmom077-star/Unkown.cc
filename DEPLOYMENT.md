# üöÄ Deployment Guide - Unknown.cc Forum

This guide will help you deploy the Unknown.cc forum application to production and fix "failed to fetch" errors.

## üî¥ Current Problem: "Failed to Fetch"

Your Netlify frontend at `https://exquisite-tanuki-2c779a.netlify.app` shows "failed to fetch" because:
- ‚ùå Frontend is deployed but **backend is not deployed**
- ‚ùå `VITE_API_BASE` environment variable is **not configured**
- ‚ùå Frontend tries to connect to `exquisite-tanuki-2c779a.netlify.app:3000` which doesn't exist

## ‚úÖ Solution: Deploy Backend + Configure API URL

---

## Step 1: Deploy Backend to Render (Required)

### 1.1 Create Render Account
1. Go to https://render.com
2. Sign up or log in with GitHub

### 1.2 Deploy Backend Service
1. Click **"New +"** ‚Üí **"Web Service"**
2. Connect your GitHub repository: `ryansmom077-star/Unkown.cc`
3. Render will automatically detect the `render.yaml` file
4. Configuration will be loaded automatically:
   - **Name**: `forum-backend`
   - **Environment**: Node
   - **Root Directory**: `server`
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Auto-deploy**: ‚úÖ Enabled (deploys on git push)

5. Click **"Create Web Service"**
6. Wait for deployment to complete (2-3 minutes)
7. **IMPORTANT**: Copy your backend URL
   - Example: `https://forum-backend-xyz123.onrender.com`
   - You'll need this for Step 2

### 1.3 Verify Backend is Running
Test your backend URL in a browser:
```
https://your-backend-url.onrender.com/api/forums/categories
```

You should see a JSON response with forum categories.

---

## Step 2: Configure Netlify Frontend

### 2.1 Add Backend URL to Netlify
1. Go to https://app.netlify.com/sites/exquisite-tanuki-2c779a/settings/env
2. Click **"Add a variable"** or **"Edit variables"**
3. Add new environment variable:
   - **Key**: `VITE_API_BASE`
   - **Value**: Your Render backend URL (from Step 1.2)
     - Example: `https://forum-backend-xyz123.onrender.com`
     - ‚ö†Ô∏è **No trailing slash!**
4. Click **"Save"**

### 2.2 Trigger New Deployment
1. Go to https://app.netlify.com/sites/exquisite-tanuki-2c779a/deploys
2. Click **"Trigger deploy"** ‚Üí **"Clear cache and deploy site"**
3. Wait for deployment to complete (1-2 minutes)

### 2.3 Test Your Site
Visit https://exquisite-tanuki-2c779a.netlify.app

‚úÖ The site should now load without "failed to fetch" errors!

---

## Step 3: Configure Backend CORS (Optional but Recommended)

For better security, update CORS to only allow your Netlify domain.

### 3.1 Update CORS Configuration
Edit `server/middleware/security.js`:

```javascript
export function corsConfig() {
  return {
    origin: process.env.NODE_ENV === 'production' 
      ? ['https://exquisite-tanuki-2c779a.netlify.app'] // Your Netlify URL
      : true,
    credentials: true,
    methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
    allowedHeaders: ['Content-Type', 'Authorization'],
    exposedHeaders: ['X-RateLimit-Limit', 'X-RateLimit-Remaining'],
    maxAge: 86400
  }
}
```

### 3.2 Set NODE_ENV in Render
1. Go to your Render dashboard
2. Select your `forum-backend` service
3. Go to **"Environment"**
4. Add variable:
   - **Key**: `NODE_ENV`
   - **Value**: `production`
5. Save changes (will trigger auto-deploy)

---

## üìã Quick Reference

### Environment Variables

**Netlify (Frontend)**
| Variable | Value | Required |
|----------|-------|----------|
| `VITE_API_BASE` | `https://your-backend.onrender.com` | ‚úÖ Yes |

**Render (Backend)**
| Variable | Value | Required |
|----------|-------|----------|
| `JWT_SECRET` | Auto-generated by Render | ‚úÖ Yes (auto) |
| `NODE_ENV` | `production` | ‚ö†Ô∏è Recommended |
| `FRONTEND_URL` | `https://exquisite-tanuki-2c779a.netlify.app` | ‚ö†Ô∏è Optional |

### Deployment URLs
- **Frontend (Netlify)**: https://exquisite-tanuki-2c779a.netlify.app
- **Backend (Render)**: https://your-backend.onrender.com (you'll get this after deployment)

---

## üß™ Testing After Deployment

### Test Backend API
```bash
curl https://your-backend.onrender.com/api/forums/categories
```

Expected: JSON response with forum data

### Test Frontend
1. Open: https://exquisite-tanuki-2c779a.netlify.app
2. Open browser DevTools (F12)
3. Check Console tab - should see no "failed to fetch" errors
4. Check Network tab - API calls should show status 200

---

## üîß Troubleshooting

### Issue: Still seeing "failed to fetch"
**Solution 1**: Clear browser cache (Ctrl+Shift+R or Cmd+Shift+R)
**Solution 2**: Check Netlify environment variables are saved
**Solution 3**: Verify you triggered a new deployment after adding VITE_API_BASE

### Issue: CORS errors
**Solution**: Check backend CORS configuration allows your Netlify domain

### Issue: Backend not responding
**Solution 1**: Check Render logs for errors
**Solution 2**: Verify backend deployed successfully
**Solution 3**: Check JWT_SECRET was generated

### Issue: 404 on API routes
**Solution**: Verify VITE_API_BASE doesn't have trailing slash

---

## üìö Additional Configuration

### Custom Domain (Optional)
If you want to use a custom domain:

1. **Netlify**: Add custom domain in site settings
2. **Update VITE_API_BASE**: Use your custom domain
3. **Update CORS**: Allow your custom domain in backend

### Email Configuration (Optional)
To enable 2FA and password reset emails:

1. Add to Render environment:
   - `SMTP_HOST`: Your SMTP server
   - `SMTP_PORT`: Usually 587
   - `SMTP_USER`: Your email
   - `SMTP_PASS`: Your email password/app password

2. Update `server/config.json` or use environment variables

---

## ‚úÖ Success Checklist

- [ ] Backend deployed to Render
- [ ] Backend URL obtained from Render
- [ ] VITE_API_BASE added to Netlify
- [ ] New Netlify deployment triggered
- [ ] Frontend loads without errors
- [ ] Can register/login
- [ ] Can view forum posts
- [ ] API calls work in Network tab

---

## üìû Need Help?

If you're still experiencing issues:
1. Check Render logs for backend errors
2. Check Netlify build logs for frontend errors
3. Check browser console for detailed error messages
4. Verify all environment variables are set correctly

**Common URLs to Check**:
- Netlify Build Logs: https://app.netlify.com/sites/exquisite-tanuki-2c779a/deploys
- Render Dashboard: https://dashboard.render.com
- Netlify Environment: https://app.netlify.com/sites/exquisite-tanuki-2c779a/settings/env
